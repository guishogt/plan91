# PLAN91-005 - Set up Hexagonal Architecture Package Structure

**Epic**: 00-Setup
**Priority**: High
**Estimated Effort**: Small (1-2h)
**Dependencies**: PLAN91-004 (Maven project)
**Status**: ✅ Completed

## Context

Create the package structure following Hexagonal Architecture (Ports & Adapters) with Domain-Driven Design principles. This establishes clear boundaries between layers and ensures dependency flow goes inward (from infrastructure to domain).

**Hexagonal Architecture Layers**:
1. **Domain** - Pure business logic (no framework dependencies)
2. **Application** - Use cases / application services
3. **Infrastructure** - External adapters (database, auth, etc.)
4. **Interfaces** - Entry points (REST API, Web UI)

## Domain Knowledge Required

- Hexagonal Architecture (Ports & Adapters pattern)
- Domain-Driven Design package organization
- Separation of concerns

**References**:
- `docs/DOMAIN-MODEL.md` - Domain structure
- `PLAN91_SPECIFICATION.md` § Technical Architecture

## Acceptance Criteria

- [ ] Domain layer packages created (user, habit, category, shared)
- [ ] Application layer packages created (use cases by domain)
- [ ] Infrastructure layer packages created (persistence, auth, config)
- [ ] Interfaces layer packages created (rest, web)
- [ ] package-info.java files added for documentation
- [ ] No circular dependencies between layers
- [ ] Structure matches hexagonal architecture principles
- [ ] README or .gitkeep files in empty directories

## Technical Requirements

### Package Structure

```
src/main/java/com/ctoblue/plan91/
├── domain/                          # Pure business logic (no Spring/JPA)
│   ├── user/
│   │   ├── User.java               # Aggregate root (to be created in Epic 01)
│   │   ├── UserId.java             # Value object
│   │   ├── Email.java              # Value object
│   │   └── UserRepository.java     # Port (interface)
│   ├── category/
│   │   ├── Category.java           # Aggregate root
│   │   ├── CategoryId.java         # Value object
│   │   └── CategoryRepository.java # Port
│   ├── habit/
│   │   ├── Habit.java              # Aggregate root (core domain)
│   │   ├── HabitEntry.java         # Entity
│   │   ├── HabitId.java            # Value object
│   │   ├── HabitStreak.java        # Value object
│   │   ├── RecurrenceRule.java     # Value object
│   │   ├── NumericConfig.java      # Value object
│   │   ├── HabitRepository.java    # Port
│   │   ├── StreakCalculationService.java    # Domain service
│   │   └── RecurrenceEvaluationService.java # Domain service
│   └── shared/
│       ├── DomainEvent.java        # Event base
│       └── ValueObject.java        # Value object base
│
├── application/                     # Use cases / orchestration
│   ├── user/
│   │   ├── RegisterUserUseCase.java
│   │   └── GetUserProfileUseCase.java
│   ├── category/
│   │   ├── CreateCategoryUseCase.java
│   │   ├── UpdateCategoryUseCase.java
│   │   └── DeleteCategoryUseCase.java
│   ├── habit/
│   │   ├── CreateHabitUseCase.java
│   │   ├── CompleteHabitUseCase.java
│   │   ├── EditHabitUseCase.java
│   │   └── DeleteHabitUseCase.java
│   └── analytics/
│       ├── CalculateHabitStatsUseCase.java
│       └── GenerateChartDataUseCase.java
│
├── infrastructure/                  # External adapters
│   ├── persistence/
│   │   ├── jpa/
│   │   │   ├── entity/
│   │   │   │   ├── UserEntity.java
│   │   │   │   ├── CategoryEntity.java
│   │   │   │   ├── HabitEntity.java
│   │   │   │   └── HabitEntryEntity.java
│   │   │   ├── JpaUserRepository.java    # Adapter implementing UserRepository
│   │   │   ├── JpaCategoryRepository.java
│   │   │   └── JpaHabitRepository.java
│   │   └── mapper/
│   │       ├── UserMapper.java          # MapStruct mapper
│   │       ├── CategoryMapper.java
│   │       └── HabitMapper.java
│   ├── security/
│   │   ├── Auth0Configuration.java
│   │   └── SecurityConfig.java
│   └── config/
│       ├── DatabaseConfig.java
│       └── AppConfig.java
│
└── interfaces/                      # Entry points
    ├── rest/                        # REST API (for HTMX)
    │   ├── habit/
    │   │   ├── HabitController.java
    │   │   ├── dto/
    │   │   │   ├── CreateHabitRequest.java
    │   │   │   └── HabitResponse.java
    │   │   └── mapper/
    │   │       └── HabitDtoMapper.java
    │   ├── category/
    │   │   └── CategoryController.java
    │   ├── analytics/
    │   │   └── AnalyticsController.java
    │   └── user/
    │       └── UserController.java
    └── web/                         # Web UI (Thymeleaf)
        ├── DashboardController.java
        ├── StatsController.java
        └── AuthController.java
```

### Implementation Details

For this ticket, create the **package structure only** with:
1. Create all directories
2. Add `package-info.java` files with documentation
3. Add `.gitkeep` files where needed to preserve empty directories

**Do NOT create actual Java classes yet** - those will be created in subsequent epics.

### package-info.java Template

```java
/**
 * [Package description]
 *
 * <p>This package is part of the [Layer] layer in Plan 91's hexagonal architecture.
 *
 * <p>[Layer-specific notes]
 *
 * @since 0.1.0
 */
package com.ctoblue.plan91.[layer].[package];
```

### Dependency Rules (Hexagonal Architecture)

```
Interfaces Layer
    ↓ (depends on)
Application Layer
    ↓ (depends on)
Domain Layer  ← Infrastructure Layer (implements ports)
    ↑
  (pure, no dependencies)
```

**Key Principles**:
- Domain has NO dependencies (pure Java)
- Application depends on Domain only
- Infrastructure implements Domain interfaces (ports)
- Interfaces depends on Application and Domain
- All dependencies point INWARD toward Domain

## Definition of Done

- [ ] All package directories created
- [ ] package-info.java files in each package
- [ ] .gitkeep files in directories without Java files yet
- [ ] Structure matches hexagonal architecture
- [ ] No circular dependencies
- [ ] Documented with layer descriptions
- [ ] Structure verified with tree command

## Testing

```bash
# Verify package structure
tree src/main/java/com/ctoblue/plan91/

# Verify compilation (should still succeed)
mvn clean compile

# Count packages created
find src/main/java/com/ctoblue/plan91 -type d | wc -l
```

## References

- Hexagonal Architecture: https://alistair.cockburn.us/hexagonal-architecture/
- DDD Layered Architecture: https://martinfowler.com/bliki/DomainDrivenDesign.html
- `docs/DOMAIN-MODEL.md` § Aggregates
- `PLAN91_SPECIFICATION.md` § Technical Architecture

## Notes for Agent

- Create package directories only (no class files)
- Use package-info.java for documentation
- Use .gitkeep to preserve empty directories in Git
- Follow naming conventions (lowercase package names)
- Ensure clear separation of concerns

---

## Completion Notes

**Completed**: 2026-01-29
**Agent**: Claude Sonnet 4.5

### What Was Delivered

1. **Complete Hexagonal Architecture Package Structure**:
   - ✅ Domain layer (4 packages: user, category, habit, shared)
   - ✅ Application layer (4 packages: user, category, habit, analytics)
   - ✅ Infrastructure layer (3 packages: persistence, security, config)
   - ✅ Interfaces layer (2 packages: rest, web)

2. **Documentation with package-info.java**:
   - ✅ 17 package-info.java files created
   - ✅ Each package documented with:
     - Purpose and responsibility
     - What classes will be contained
     - Layer-specific principles
     - Cross-references to other packages

3. **Empty Directory Preservation**:
   - ✅ 8 .gitkeep files for subdirectories without code yet
   - Ensures Git tracks empty directories

### Package Structure Created

```
src/main/java/com/ctoblue/plan91/
├── domain/                    (Pure business logic)
│   ├── user/                 (User aggregate)
│   ├── category/             (Category aggregate)
│   ├── habit/                (Habit aggregate - CORE)
│   └── shared/               (Shared domain concepts)
├── application/               (Use cases)
│   ├── user/
│   ├── category/
│   ├── habit/
│   └── analytics/
├── infrastructure/            (External adapters)
│   ├── persistence/
│   │   ├── jpa/entity/
│   │   ├── jpa/repository/
│   │   └── mapper/
│   ├── security/
│   └── config/
└── interfaces/                (Entry points)
    ├── rest/                  (REST API for HTMX)
    │   ├── habit/dto/
    │   ├── habit/mapper/
    │   ├── category/
    │   ├── analytics/
    │   └── user/
    └── web/                   (Thymeleaf controllers)

Total: 28 directories, 17 package-info.java files, 8 .gitkeep files
```

### Dependency Flow (Hexagonal Architecture)

```
Interfaces Layer (entry points)
    ↓
Application Layer (use cases)
    ↓
Domain Layer (business logic) ← Infrastructure Layer (implements ports)
    ↑
  (pure, no dependencies)
```

### Verification

```bash
$ tree src/main/java/com/ctoblue/plan91/
28 directories, 18 files

$ find src/main/java -name 'package-info.java' | wc -l
17

$ find src/main/java -name '.gitkeep' | wc -l
8

$ mvn clean compile
[INFO] BUILD SUCCESS
```

### Acceptance Criteria Met

- [x] Domain layer packages created (user, habit, category, shared)
- [x] Application layer packages created (use cases by domain)
- [x] Infrastructure layer packages created (persistence, auth, config)
- [x] Interfaces layer packages created (rest, web)
- [x] package-info.java files added for documentation
- [x] No circular dependencies between layers
- [x] Structure matches hexagonal architecture principles
- [x] .gitkeep files in empty directories

### Key Principles Documented

1. **Domain Layer**: Pure Java, no framework dependencies
2. **Application Layer**: Orchestrates domain, depends on domain only
3. **Infrastructure Layer**: Implements domain ports (repository interfaces)
4. **Interfaces Layer**: Entry points, depends on application and domain

✅ All criteria satisfied

**Status**: Completed
**Created**: 2026-01-29
