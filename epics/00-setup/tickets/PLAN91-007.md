# PLAN91-007 - Set up Basic Logging Configuration

**Epic**: 00-Setup
**Priority**: Medium
**Estimated Effort**: Small (1h)
**Dependencies**: PLAN91-004 (Maven project)
**Status**: ✅ Completed

## Context

Configure Logback (Spring Boot's default logging framework) with appropriate log levels, patterns, and file outputs for development and production environments.

Good logging is essential for debugging, monitoring, and understanding application behavior.

## Acceptance Criteria

- [ ] logback-spring.xml created with configuration
- [ ] Console logging with colored output
- [ ] File logging for persistence
- [ ] Different log levels per profile (dev, test, prod)
- [ ] Appropriate log levels for Plan 91 packages
- [ ] Appropriate log levels for Spring/Hibernate
- [ ] Log file rotation configured
- [ ] Log pattern includes timestamp, level, logger, thread, message

## Technical Requirements

### Implementation Details

Create `src/main/resources/logback-spring.xml` with:
1. Console appender (colored for dev)
2. File appender with rolling policy
3. Profile-specific configurations
4. Package-level log levels

### Logback Configuration

**Log Levels** (most to least verbose):
- TRACE - Very detailed, rarely used
- DEBUG - Detailed for development
- INFO - General informational messages
- WARN - Warnings
- ERROR - Errors

**Plan 91 Log Levels**:
- Development: DEBUG for our code, INFO for frameworks
- Test: INFO for our code, WARN for frameworks
- Production: INFO for our code, WARN for frameworks

### File Structure

```
src/main/resources/
├── logback-spring.xml          # Main logging config
└── application.yml             # Already has basic logging config
```

### logback-spring.xml Template

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- Include Spring Boot defaults -->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <!-- Console appender -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>

    <!-- File appender with rolling -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/plan91.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>logs/plan91.%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>30</maxHistory>
            <totalSizeCap>1GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- Development profile -->
    <springProfile name="dev">
        <logger name="com.ctoblue.plan91" level="DEBUG"/>
        <logger name="org.springframework" level="INFO"/>
        <logger name="org.hibernate" level="INFO"/>
        <logger name="org.hibernate.SQL" level="DEBUG"/>
        <logger name="org.hibernate.type.descriptor.sql.BasicBinder" level="TRACE"/>

        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>

    <!-- Test profile -->
    <springProfile name="test">
        <logger name="com.ctoblue.plan91" level="INFO"/>
        <logger name="org.springframework" level="WARN"/>
        <logger name="org.hibernate" level="WARN"/>

        <root level="WARN">
            <appender-ref ref="CONSOLE"/>
        </root>
    </springProfile>

    <!-- Production profile -->
    <springProfile name="prod">
        <logger name="com.ctoblue.plan91" level="INFO"/>
        <logger name="org.springframework" level="WARN"/>
        <logger name="org.hibernate" level="WARN"/>

        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>
</configuration>
```

### Log Pattern Explanation

```
%d{yyyy-MM-dd HH:mm:ss.SSS} - Timestamp
[%thread]                    - Thread name
%-5level                     - Log level (padded to 5 chars)
%logger{36}                  - Logger name (max 36 chars)
%msg                         - Log message
%n                           - New line
```

### Update .gitignore

Add logs directory to .gitignore:
```
# Logs
logs/
*.log
```

## Definition of Done

- [ ] logback-spring.xml created and configured
- [ ] Console logging works with colored output (dev)
- [ ] File logging works with rotation
- [ ] Different configs for dev/test/prod profiles
- [ ] Log levels appropriate for each package
- [ ] Logs directory in .gitignore
- [ ] Application starts and logs correctly
- [ ] Verified with `mvn spring-boot:run`

## Testing

```bash
# Start application (dev profile)
mvn spring-boot:run

# Should see colored console output with:
# - Application startup logs
# - Spring Boot banner
# - Port information
# - Our custom log messages

# Check log file created
ls -la logs/
cat logs/plan91.log

# Test different log levels
# Edit a controller to add log statements at different levels
```

## References

- Logback Documentation: https://logback.qos.ch/manual/
- Spring Boot Logging: https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.logging

## Notes for Agent

- Use logback-spring.xml (not logback.xml) for Spring profile support
- Console colored output only works in dev profile
- File appender creates logs/ directory automatically
- Keep log files out of Git (add to .gitignore)
- Test with actual application startup

---

## Completion Notes

**Completed**: 2026-01-29
**Agent**: Claude Sonnet 4.5

### What Was Delivered

1. **logback-spring.xml Configuration**:
   - Console appender with colored output (dev profile)
   - File appender with rolling policy (daily, 30-day retention, 1GB cap)
   - Profile-specific configurations (dev, test, prod)
   - Appropriate log levels per package

2. **Log Levels Configured**:

   **Development Profile**:
   - com.ctoblue.plan91: DEBUG
   - org.springframework.security: DEBUG
   - org.hibernate.SQL: DEBUG (shows SQL)
   - org.hibernate.type.descriptor.sql.BasicBinder: TRACE (shows parameters)

   **Test Profile**:
   - com.ctoblue.plan91: INFO (less verbose)
   - Frameworks: WARN (reduce test output)
   - Testcontainers: INFO

   **Production Profile**:
   - com.ctoblue.plan91: INFO
   - All frameworks: WARN
   - Security: INFO (for auth events)

3. **File Logging**:
   - Logs written to `logs/plan91.log`
   - Daily rollover: `logs/plan91.2026-01-30.log`
   - Max 30 days of history
   - Total size cap: 1GB

4. **.gitignore Updated**:
   - Added `logs/` directory
   - Added `*.log` files
   - Added `plan91.log`

### Log Format

```
2026-01-30 10:10:38.502 [restartedMain] INFO  c.ctoblue.plan91.Plan91Application - Starting Plan91Application using Java 21.0.9
2026-01-30 10:10:38.503 [restartedMain] DEBUG c.ctoblue.plan91.Plan91Application - Running with Spring Boot v3.2.2
```

Pattern: `timestamp [thread] level logger - message`

### Verification

```bash
$ mvn spring-boot:run

# Console output: Colored, DEBUG level for our code
# File created: logs/plan91.log

$ head -5 logs/plan91.log
2026-01-30 10:10:38.502 [restartedMain] INFO  c.ctoblue.plan91...
2026-01-30 10:10:38.503 [restartedMain] DEBUG c.ctoblue.plan91...
✓ Application started successfully
✓ Logs created with proper formatting
✓ DEBUG level working for com.ctoblue.plan91
✓ INFO level working for Spring Framework
```

### Acceptance Criteria Met

- [x] logback-spring.xml created and configured
- [x] Console logging works with colored output (dev)
- [x] File logging works with rotation
- [x] Different configs for dev/test/prod profiles
- [x] Log levels appropriate for each package
- [x] Logs directory in .gitignore
- [x] Application starts and logs correctly
- [x] Verified with `mvn spring-boot:run`

### Features

- ✅ Profile-aware logging (dev/test/prod)
- ✅ Console + file appenders
- ✅ SQL logging in dev (with parameters)
- ✅ Daily log rotation
- ✅ Size cap management
- ✅ Thread names in logs
- ✅ Proper log level hierarchy

✅ All criteria satisfied

**Status**: Completed
**Created**: 2026-01-29
