# PLAN91-021: Integrate HTMX into Project

**Epic**: 02 - Frontend Foundation
**Status**: ✅ Complete
**Priority**: High
**Effort**: Small (1-2 hours)
**Assignee**: AI Agent

---

## Description

Integrate HTMX into the project to enable dynamic HTML interactions without writing JavaScript. HTMX allows server-side rendering with dynamic updates using HTML attributes like `hx-get`, `hx-post`, `hx-target`, and `hx-swap`.

---

## Context

HTMX is a lightweight library that extends HTML with attributes for AJAX, CSS transitions, WebSockets, and Server-Sent Events. It fits perfectly with our server-side rendering approach using Thymeleaf.

**Why HTMX?**
- No JavaScript framework needed (React, Vue, etc.)
- Server-side rendering stays simple
- Progressive enhancement approach
- Minimal bundle size (~14KB gzipped)
- Works seamlessly with Spring Boot and Thymeleaf

---

## Acceptance Criteria

### Must Have
- [ ] HTMX library downloaded and placed in `src/main/resources/static/js/`
- [ ] HTMX included in test page template
- [ ] Create demo page showing HTMX interactions (button click, form submission, etc.)
- [ ] Verify HTMX works with Thymeleaf templates
- [ ] Document HTMX usage patterns for the team

### Should Have
- [ ] Alpine.js added for minimal client-side state (optional, very lightweight)
- [ ] Example of common HTMX patterns (partial updates, loading states, etc.)

### Nice to Have
- [ ] HTMX extensions (e.g., loading-states, response-targets)
- [ ] Example of HTMX with forms and validation

---

## Technical Design

### 1. Download HTMX

**Option A**: Download from CDN and save locally (Recommended for production)
```bash
curl -o src/main/resources/static/js/htmx.min.js https://unpkg.com/htmx.org@1.9.10/dist/htmx.min.js
```

**Option B**: Use CDN directly (easier for development)
```html
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
```

**Decision**: Download locally for version control and offline capability.

### 2. File Structure

```
src/main/resources/static/js/
├── htmx.min.js              # Core HTMX library
└── alpine.min.js            # Optional: Alpine.js for client-side state
```

### 3. Include in Templates

**Base Layout** (future):
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <!-- Content -->

    <!-- HTMX at end of body for performance -->
    <script src="/js/htmx.min.js"></script>
    <script src="/js/alpine.min.js" defer></script>
</body>
</html>
```

### 4. HTMX Demo Page

Create a demo page showing common HTMX patterns:

**Example 1: Click to Load Content**
```html
<button hx-get="/api/demo/message"
        hx-target="#result"
        hx-swap="innerHTML"
        class="btn-primary">
    Load Message
</button>
<div id="result"></div>
```

**Example 2: Form Submission**
```html
<form hx-post="/api/demo/submit"
      hx-target="#form-result"
      hx-swap="innerHTML">
    <input type="text" name="name" class="form-input">
    <button type="submit" class="btn-primary">Submit</button>
</form>
<div id="form-result"></div>
```

**Example 3: Delete with Confirmation**
```html
<button hx-delete="/api/demo/item/123"
        hx-confirm="Are you sure you want to delete this?"
        hx-target="#item-123"
        hx-swap="outerHTML swap:1s"
        class="btn-danger">
    Delete
</button>
```

### 5. Create Spring Controller for Demo

Create a simple controller to demonstrate HTMX endpoints:

```java
@Controller
@RequestMapping("/demo")
public class HtmxDemoController {

    @GetMapping("/message")
    @ResponseBody
    public String getMessage() {
        return "<p class='text-success-600'>✅ HTMX is working! This content was loaded dynamically.</p>";
    }

    @PostMapping("/submit")
    @ResponseBody
    public String submitForm(@RequestParam String name) {
        return "<p class='text-primary-600'>Hello, " + name + "! Form submitted via HTMX.</p>";
    }
}
```

### 6. Alpine.js Integration (Optional)

For minimal client-side interactivity:

```html
<div x-data="{ open: false }">
    <button @click="open = !open" class="btn-secondary">Toggle</button>
    <div x-show="open" class="mt-4">
        <p>This content is toggled with Alpine.js (no server request needed)</p>
    </div>
</div>
```

---

## Implementation Steps

1. **Download HTMX library**
   ```bash
   mkdir -p src/main/resources/static/js
   curl -o src/main/resources/static/js/htmx.min.js https://unpkg.com/htmx.org@1.9.10/dist/htmx.min.js
   ```

2. **Download Alpine.js (optional)**
   ```bash
   curl -o src/main/resources/static/js/alpine.min.js https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js
   ```

3. **Create HTMX demo controller**
   - Create `HtmxDemoController.java` in appropriate package
   - Add simple GET/POST endpoints

4. **Create HTMX demo page**
   - Create `test-htmx.html` in templates
   - Showcase common HTMX patterns
   - Include loading indicators
   - Show form submission

5. **Test HTMX interactions**
   - Start Spring Boot app
   - Open demo page in browser
   - Test all HTMX interactions
   - Verify browser network tab shows AJAX requests

6. **Document HTMX patterns**
   - Add comments to demo page
   - Create reference for common patterns

---

## Testing

### Manual Testing
1. Start Spring Boot application
2. Navigate to `/test-htmx.html`
3. Test each HTMX interaction:
   - Click button to load content
   - Submit form via HTMX
   - Verify partial page updates
   - Check browser network tab for AJAX requests
4. Verify no JavaScript errors in console

### HTMX Patterns to Test
- [x] `hx-get` - GET request
- [x] `hx-post` - POST request
- [x] `hx-target` - Target element for response
- [x] `hx-swap` - How to swap content (innerHTML, outerHTML, etc.)
- [x] Loading indicators
- [x] Form serialization

---

## Definition of Done

- [ ] HTMX library downloaded to `static/js/htmx.min.js`
- [ ] Alpine.js downloaded to `static/js/alpine.min.js` (optional)
- [ ] `HtmxDemoController` created with demo endpoints
- [ ] `test-htmx.html` created with working examples
- [ ] All HTMX interactions tested and working
- [ ] No JavaScript errors in browser console
- [ ] Documentation comments added to demo page
- [ ] Code compiles with `mvn clean compile`
- [ ] EPIC.md updated
- [ ] CURRENT_WORK.md updated

---

## Related Files

**New Files**:
- `src/main/resources/static/js/htmx.min.js`
- `src/main/resources/static/js/alpine.min.js`
- `src/main/resources/templates/test-htmx.html`
- `src/main/java/com/ctoblue/plan91/adapter/in/web/demo/HtmxDemoController.java`

**Modified Files**:
- `docs/CURRENT_WORK.md`
- `epics/02-frontend-foundation/EPIC.md`

---

## References

- [HTMX Documentation](https://htmx.org/docs/)
- [HTMX Examples](https://htmx.org/examples/)
- [Alpine.js Documentation](https://alpinejs.dev/)
- [HTMX with Spring Boot](https://htmx.org/essays/spring-boot-htmx/)

---

**Created**: 2026-01-31
**Estimated Time**: 1-2 hours
**Actual Time**: TBD
